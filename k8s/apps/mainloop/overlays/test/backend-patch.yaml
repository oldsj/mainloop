# Patch backend deployment for local testing
apiVersion: apps/v1
kind: Deployment
metadata:
  name: mainloop-backend
  namespace: mainloop
spec:
  template:
    spec:
      # Remove GHCR image pull secrets (using local images)
      imagePullSecrets: []
      containers:
        - name: backend
          # Use locally loaded image, never try to pull
          imagePullPolicy: Never
          # Add IS_TEST_ENV for test endpoints
          env:
            - name: IS_TEST_ENV
              value: 'true'
            # Use cheapest/fastest model for tests
            - name: CLAUDE_MODEL
              value: haiku
            # Mock Claude for fast testing (set to 'false' for real Claude tests)
            - name: USE_MOCK_CLAUDE
              value: 'true'
            # Mock GitHub API (always true in tests - no real GitHub calls)
            - name: USE_MOCK_GITHUB
              value: 'true'
